# 接口文档（PLANB）

**项目后端技术栈：SpringBoot，Mybtis-Plus，Lombok，JWT，MySQL**

**说明：**

- **后端使用token实现单点登陆，拦截器拦截除/login和/reg的请求，拦截到了进行token验证，成功在Session中返回code 200，失败返回code 401。请求如果返回空就有可能是被拦截器拦截了**
- **所有测试接口的操作要确保发送了用户登陆请求**
- 传过来的**任务内容，日报内容，计划内容** 可能会包含**以`\`开头**的制表符**不要忘记格式转换**，还会包含**空格**

**CODE状态码说明：**

| 401  | token验证失败 |
| ---- | ------------- |
| 400  | 用户不存在    |
| 402  | 注册失败      |
| 403  | 权限不足      |
| 405  | 发布失败      |
| 406  | 更新失败      |
| 407  | 删除失败      |
| 408  | 文件上传失败  |



# 登陆注册模块

## 用户登陆

用户登陆，验证用户是否存在。并生成token存放到cookie中

| URL        | /login                                      |
| ---------- | ------------------------------------------- |
| 请求方式   | POST                                        |
| 后端负责人 | 陈俊杰                                      |
| 请求参数   | `{"username":"用户名",  "password":"密码"}` |
| 返回参数   | `{"code":"状态码"}`  code为字符串           |
| 前端负责人 |                                             |

## 用户注册

**用户注册，存入用户附带工作室名称。如果该工作室不存在会自动创建**

用户角色为  **老师或学生**

学号为**纯数字**

| URL        | /reg                                                         |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | POST                                                         |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | `{"username":"用户名",  "password":"密码", "role":"用户角色", "uid":"学号","telnumber":"电话号码","sname":"工作室名"}` |
| 返回参数   | `{"code":"状态码"}  code为字符串，请求错误返回{"status":"400"}` |
| 前端负责人 |                                                              |

# 任务模块

在发布任务的同时如果要**上传相关说明文件**，就**再发送一个文件上传请求**（不要忘记）

## 获取全部任务

获取全部任务

| URL        | /task              |
| ---------- | ------------------ |
| 请求方式   | GET                |
| 后端负责人 | 陈俊杰             |
| 请求参数   | 无                 |
| 返回参数   | 下面附带了具体说明 |
| 前端负责人 |                    |

```json
[
    {
        "tid": 任务id是整形的,
        "publisher": "发布人",
        "tbody": "任务内容",
        "tname": "任务名字",
        "tfiles": "附带文件名，如果没有就是空",
        "progress": "任务进程",
        "startdate": "2022-01-19T16:00:00.000+00:00",
        "enddate": "2022-01-31T16:00:00.000+00:00",
        "tmembers": "任务成员以','分割",
        "tdate": "2022-01-19T16:00:00.000+00:00"
    },
	……
]
```



## 发布任务

**发布任务，如果附带了文件请再发送一下文件上传请求**

| URL        | /task                                                        |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | POST                                                         |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | 如下说明                                                     |
| 返回参数   | `{"code":"状态码"}如果附带了文件名参数还会返回文件保存到服务器的名字{"filename":"文件名"}` |
| 前端负责人 |                                                              |

请求参数具体

```json
{
    "tbody":"任务说明，内容",
    "tname":"任务名字",
    "tfiles":"任务附带文件名字，只可附带一个文件，可以为空",
    "progress":"任务进程0-100",
    "startdate":"任务开始日期yyyy-MM-dd",
    "enddate":"任务结束日期yyyy-MM-dd",
    "tmembers":"任务成员以','分割"
}
```

## 更新任务进度

跟新任务进度0-100，任务id为整形

| URL        | /task                                   |
| ---------- | --------------------------------------- |
| 请求方式   | PUT                                     |
| 后端负责人 | 陈俊杰                                  |
| 请求参数   | `{"progress":"进度0-100","tid":任务id}` |
| 返回参数   | `{"code":"状态码"}`                     |
| 前端负责人 |                                         |

## 删除任务

删除任务，将任务删除，老师才可以删除

| URL        | /task               |
| ---------- | ------------------- |
| 请求方式   | DELETE              |
| 后端负责人 | 陈俊杰              |
| 请求参数   | `{"tid":任务id}`    |
| 返回参数   | `{"code":"状态码"}` |
| 前端负责人 |                     |

# 文件上传模块

## 上传文件

上传文件，可以上传头像，任务附带文件。单个最大50MB

| URL        | /file                                                        |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | POST                                                         |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | `{"filebody":文件,"filename":"处理过的文件名，后端传过来再由前端去上传"}` |
| 返回参数   | `{"code":"状态码"}`                                          |
| 前端负责人 |                                                              |

filebody的请求**content-type**应为**multipart/form-data**因为是文件上传

# 日报与计划模块

## 获取全部日报（今天的和昨天的）

时间区间由后端决定，所以不用传参数

| URL        | /daily         |
| ---------- | -------------- |
| 请求方式   | GET            |
| 后端负责人 | 陈俊杰         |
| 请求参数   | 无             |
| 返回参数   | 下面有具体说明 |
| 前端负责人 |                |

```json
[
    {
        "dname": "日报名",
        "did": 日报id整形,
        "ddate": "2022-01-22T03:36:30.000+00:00" 日报日期,
        "reporter": "日报人",
        "dbody": "日报内容"
    },
	……
]
```

## 获取指定用户名的日报

传入url**路径参数**

| URL        | /daily/{用户名} |
| ---------- | --------------- |
| 请求方式   | GET             |
| 后端负责人 | 陈俊杰          |
| 请求参数   | 写在url上面     |
| 返回参数   | 下面有具体说明  |
| 前端负责人 |                 |

```json
[
    {
        "dname": "日报名",
        "did": 日报id整形,
        "ddate": "2022-01-22T03:36:30.000+00:00" 日报日期,
        "reporter": "日报人",
        "dbody": "日报内容"
    },
	……
]
```

## 发布日报

发布日报

| URL        | /daily                                    |
| ---------- | ----------------------------------------- |
| 请求方式   | POST                                      |
| 后端负责人 | 陈俊杰                                    |
| 请求参数   | `{"dname":"日报标题","dbody":"日报内容"}` |
| 返回参数   | `{"code":"状态码"}`                       |
| 前端负责人 |                                           |

## 获取指定用户名的所有计划

传入url**路径参数**

| URL        | /plan/{用户名} |
| ---------- | -------------- |
| 请求方式   | GET            |
| 后端负责人 | 陈俊杰         |
| 请求参数   | 写在url上面    |
| 返回参数   | 下面有具体说明 |
| 前端负责人 |                |

```json
[
    {
        "pid": 计划id整形,
        "pname": "计划标题",
        "pbody": "计划内容",
        "ptype": "计划类型",
        "planner": "计划人"
    },
    ……
]
```

## 发布计划

发布时带的ptype值必须为下面中的一个：

- **周计划**
- **月计划**
- **学期计划**

要不然会返回code 405

| URL        | /plan                                                        |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | POST                                                         |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | `{"pname":"计划标题","pbody":"计划内容","ptype":"计划类型"}` |
| 返回参数   | `{"code":"状态码"}`                                          |
| 前端负责人 |                                                              |

# 工作室模块

## 获取全部工作室

获取全部工作室，返回的工作室成员字段使用`,`分割名字的字符串`user1,user2,user3,……`

| URL        | /studio        |
| ---------- | -------------- |
| 请求方式   | GET            |
| 后端负责人 | 陈俊杰         |
| 请求参数   | 无             |
| 返回参数   | 下面有具体说明 |
| 前端负责人 |                |

```json
[
    {
        "sid": 工作室id整形,
        "smembers": "工作室成员",
        "sheadicon": "工作室图标的文件名，不是原始上传的文件名，处理过的",
        "sname": "工作室名字"
    },
    ……
]
```

## 更改工作室图标

请不要忘记，**先请求一个改图标，会返回一个处理过的文件名，再根据这个新的文件名请求上传文件。**

| URL        | /studio                                         |
| ---------- | ----------------------------------------------- |
| 请求方式   | POST                                            |
| 后端负责人 | 陈俊杰                                          |
| 请求参数   | `{"filename":"原始文件名","sname":"工作室名"}`  |
| 返回参数   | `{"filename":"处理过的文件名","code":"状态码"}` |
| 前端负责人 |                                                 |

**不要忘记用处理过的文件名去请求上传文件**

# 我的模块

## 获取个人基本信息

获取基本信息，**headiconURL**是文件存放在服务器上的绝对路径

| URL        | /personal/{uid}                                              |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | GET                                                          |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | url上面写                                                    |
| 返回参数   | `{"username":"用户名","headiconURL":"头像url","sname":"工作室名字"}` |
| 前端负责人 |                                                              |

## 上传考核信息

上传的时候**不要**用**显式的url**，使用**form-data**的方式请求要不然json字符串(score)带不了`{}`

| URL        | /pfm                                                         |
| ---------- | ------------------------------------------------------------ |
| 请求方式   | POST                                                         |
| 后端负责人 | 陈俊杰                                                       |
| 请求参数   | `{"uid":"用户id","score":"学科对应成绩的json字符串","info":"说明"}` |
| 返回参数   | `{"code":"状态码"}`                                          |
| 前端负责人 |                                                              |

## 显示指定用户的考核信息

| URL        | /pfm/{uid}   |
| ---------- | ------------ |
| 请求方式   | GET          |
| 后端负责人 | 陈俊杰       |
| 请求参数   | url上面写    |
| 返回参数   | 下面具体说明 |
| 前端负责人 |              |

```json
[
    {
        "uid": 用户id整形,
        "score": "{\"语文\":100,\"数学\":100,\"英语\":100,\"科学\":100}"考试成绩json,
        "info": "说明",
        "date": "日期",
        "pfmid": 成绩id整形
    },
    ……
]
```

